# インセンティブ計算スクリプト（Google Apps Script）

## 📌 概要

このGoogle Apps Scriptは、訪問看護ステーション等のスタッフに対して、以下のデータを元に**インセンティブと役職手当を自動計算**し、Google スプレッドシートに出力するものです。

- スケジュールシート（訪問記録）
- 件数確認表（外部スプレッドシート2件）
- 基準シート（スタッフ別基準時間、役職、割合など）
- 役職手当表（グループ実績に応じた手当）
- 祝日シート（祝日データ）

---

## 🛠 使用手順

1. **スプレッドシート構成を準備**

   以下のシート名が正しく設定されている必要があります：

   - `基準`：スタッフの基準時間・所属・職種・役職など
   - `役職手当`：役職ごとの手当金額表
   - `祝日`：月・日形式の祝日一覧
   - `インセンティブ`：出力先（自動作成または上書き）

2. **スクリプトをスプレッドシートに貼り付ける**

   スクリプトエディタでこのリポジトリのコードを貼り付けます。

3. **`calculateIncentives()` を実行**

   - スケジュールシート名を選択
   - 対象の年と月を入力
   - 件数確認表のスプレッドシートURL（2件）を入力

4. `インセンティブ` シートに以下の情報が出力されます：

   | ID | スタッフ名 | 基準時間 | 訪問時間 | 件数確認 | 合計時間 | 特別手当対象時間 | インセンティブ | 役職手当 | 最終合計 |

---

## 📊 出力されるデータの意味

| 項目 | 内容 |
|------|------|
| **ID** | スタッフ固有のID（基準シートA列） |
| **基準時間** | 月間の期待勤務時間 |
| **訪問時間** | 実際の訪問実績時間（平日・営業時間内） |
| **件数確認** | 外部ファイルから取得した訪問件数の加算値 |
| **特別時間** | 土日祝・時間外訪問の時間（優先されて計算） |
| **インセンティブ** | (合計時間 - 基準時間) × 4000円（特別時間が優先） |
| **役職手当** | 所属グループ単位の実績に応じた役職別手当 |
| **最終合計** | インセンティブ + 役職手当 |

---

## 💡 補足仕様

- **役職手当**：同じ「事業所 × 職種」グループ全体の訪問時間合計に応じて金額が決定されます。
- **分数→時間変換**：例）30分→0.6時間、60分→1.0時間など
- **休日/時間外判定**：
  - 土日、祝日：`祝日` シートと曜日から判定
  - 営業時間外：9:00～18:00以外
- **件数確認表の取得**：
  - 入力されたURLから `H40` セルの値を取得し加算
  - 各スタッフタブ名が一致する必要があります（空白に注意）

---

## ⚠ 注意点

- シート名、列構成が正確でないと動作しません。
- インセンティブがマイナスになる場合は自動的に 0 に補正されます。
- 実行には Google Apps Script の権限認可が必要です。
- 外部スプレッドシートのURLからIDを抽出できないと失敗します。

---

## 📂 ファイル構成

